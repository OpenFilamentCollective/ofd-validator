name: Test Python Bindings

on:
  pull_request:
    paths:
      - 'src/**'
      - 'Cargo.toml'
      - 'pyproject.toml'
      - '.github/workflows/test-python-bindings.yml'
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'Cargo.toml'
      - 'pyproject.toml'

jobs:
  test:
    name: Test (${{ matrix.os }}, Python ${{ matrix.python-version }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        python-version: ['3.8', '3.13']  # Test oldest and newest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install Rust toolchain
        uses: actions-rust-lang/setup-rust-toolchain@v1

      - name: Install maturin
        run: pip install maturin

      - name: Build Python package
        run: maturin develop --release --features python

      - name: Test import
        run: |
          python -c "from ofd_validator import PyValidationOrchestrator; print('✓ Import successful')"

      - name: Test basic functionality
        run: |
          python -c "
          from ofd_validator import PyValidationOrchestrator
          import json

          # Create orchestrator
          orch = PyValidationOrchestrator('.', '.')
          print('✓ Orchestrator created')

          # Test methods exist
          assert hasattr(orch, 'validate_all')
          assert hasattr(orch, 'validate_json_files')
          assert hasattr(orch, 'validate_logo_files')
          print('✓ All methods exist')
          "
